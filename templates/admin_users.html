{% extends "base.html" %}
{% block title %}Manage Users - {{ library.name }}{% endblock %}
{% block extra_css %}
<style>
.users-container{max-width:1400px;margin:0 auto}.users-header{background:#fff;border-radius:15px;padding:30px;margin-bottom:30px;box-shadow:0 4px 15px rgba(0,0,0,.1)}.users-title{color:#2d5016;font-size:2rem;margin-bottom:10px;font-weight:700}.section{background:#fff;border-radius:15px;padding:30px;margin-bottom:30px;box-shadow:0 4px 15px rgba(0,0,0,.1)}.section-title{color:#2d5016;font-size:1.5rem;margin-bottom:20px;font-weight:700;padding-bottom:15px;border-bottom:3px solid #e5e7eb}.users-table{width:100%;border-collapse:collapse;margin-top:20px}.users-table th{background:#f9fafb;padding:12px;text-align:left;font-weight:600;color:#333;border-bottom:2px solid #e5e7eb}.users-table td{padding:12px;border-bottom:1px solid #e5e7eb}.users-table tr:hover{background:#f9fafb}.badge{display:inline-block;padding:4px 12px;border-radius:12px;font-size:.85rem;font-weight:600}.badge-admin{background:#fbbf24;color:#78350f}.badge-staff{background:#3b82f6;color:#fff}.badge-user{background:#e5e7eb;color:#666}.empty-state{text-align:center;padding:60px 20px;color:#666}.empty-icon{font-size:4rem;margin-bottom:20px}.btn{padding:10px 20px;border-radius:8px;font-weight:600;cursor:pointer;border:none;transition:all .3s;text-decoration:none;display:inline-block}.btn-primary{background:#4a7c2c;color:#fff}.btn-primary:hover{background:#2d5016}.btn-danger{background:#ef4444;color:#fff;font-size:.85rem;padding:6px 12px}.btn-danger:hover{background:#dc2626}
</style>
{% endblock %}
{% block content %}
<div class="users-container">
<a href="/admin/{{ library.slug }}" class="btn btn-primary" style="margin-bottom:20px">‚Üê Back to Dashboard</a>
<div class="users-header">
<h1 class="users-title">üë• User Management</h1>
<p style="color:#666;font-size:1.1rem">Manage users and staff for {{ library.name }}</p>
</div>

<!-- Library Staff Section -->
<div class="section">
<h2 class="section-title">üõ†Ô∏è Library Staff & Admins</h2>
{% if staff %}
<table class="users-table">
<thead>
<tr>
<th>Username</th>
<th>Email</th>
<th>Role</th>
<th>Assigned On</th>
<th>Actions</th>
</tr>
</thead>
<tbody>
{% for assignment in staff %}
<tr>
<td><strong>{{ assignment.user.username }}</strong></td>
<td>{{ assignment.user.email }}</td>
<td>
{% if assignment.role.value == 'admin' %}
<span class="badge badge-admin">Admin</span>
{% else %}
<span class="badge badge-staff">Staff</span>
{% endif %}
</td>
<td>{{ assignment.assigned_at.strftime('%b %d, %Y') }}</td>
<td>
<span style="color:#666;font-size:.9rem">Managed by CSR Admin</span>
</td>
</tr>
{% endfor %}
</tbody>
</table>
{% else %}
<div class="empty-state">
<div class="empty-icon">üëî</div>
<p style="font-size:1.2rem;font-weight:600">No Staff Assigned</p>
<p>Library staff can be assigned by CSR Super Admins</p>
</div>
{% endif %}
</div>

<!-- Active Users Section -->
<div class="section">
<h2 class="section-title">üìö Active Library Users</h2>
<p style="color:#666;margin-bottom:20px">Users who have made bookings at this library</p>
{% if users_with_bookings %}
<table class="users-table">
<thead>
<tr>
<th>Username</th>
<th>Email</th>
<th>Total Bookings</th>
<th>Active Bookings</th>
<th>Last Booking</th>
<th>Status</th>
</tr>
</thead>
<tbody>
{% for user, stats in user_stats.items() %}
<tr>
<td><strong>{{ user.username }}</strong></td>
<td>{{ user.email }}</td>
<td>{{ stats.total_bookings }}</td>
<td>{{ stats.active_bookings }}</td>
<td>{{ stats.last_booking.strftime('%b %d, %Y') if stats.last_booking else 'N/A' }}</td>
<td>
{% if user.is_active %}
<span class="badge" style="background:#d1fae5;color:#065f46">Active</span>
{% else %}
<span class="badge" style="background:#fee2e2;color:#991b1b">Inactive</span>
{% endif %}
</td>
</tr>
{% endfor %}
</tbody>
</table>
{% else %}
<div class="empty-state">
<div class="empty-icon">üì≠</div>
<p style="font-size:1.2rem;font-weight:600">No Users Yet</p>
<p>Users will appear here once they make their first booking</p>
</div>
{% endif %}
</div>

<!-- Statistics -->
<div class="section">
<h2 class="section-title">üìä User Statistics</h2>
<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px">
<div style="background:#f9fafb;padding:20px;border-radius:10px;text-align:center">
<div style="font-size:2rem;font-weight:700;color:#2d5016">{{ staff|length }}</div>
<div style="color:#666">Staff Members</div>
</div>
<div style="background:#f9fafb;padding:20px;border-radius:10px;text-align:center">
<div style="font-size:2rem;font-weight:700;color:#2d5016">{{ users_with_bookings|length }}</div>
<div style="color:#666">Active Users</div>
</div>
<div style="background:#f9fafb;padding:20px;border-radius:10px;text-align:center">
<div style="font-size:2rem;font-weight:700;color:#2d5016">{{ total_bookings }}</div>
<div style="color:#666">Total Bookings</div>
</div>
</div>
</div>

</div>
{% endblock %}
