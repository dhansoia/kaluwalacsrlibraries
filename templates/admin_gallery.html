{% extends "base.html" %}
{% block title %}Photo Gallery - {{ library.name }}{% endblock %}
{% block extra_css %}
<style>
.gallery-container{max-width:1400px;margin:0 auto}.gallery-header{background:#fff;border-radius:15px;padding:30px;margin-bottom:30px;box-shadow:0 4px 15px rgba(0,0,0,.1)}.gallery-title{color:#2d5016;font-size:2rem;margin-bottom:10px;font-weight:700}.upload-section{background:#fff;border-radius:15px;padding:30px;margin-bottom:30px;box-shadow:0 4px 15px rgba(0,0,0,.1)}.upload-area{border:3px dashed #d1d5db;border-radius:10px;padding:40px;text-align:center;cursor:pointer;transition:all .3s}.upload-area:hover{border-color:#4a7c2c;background:#f9fafb}.upload-area.dragover{border-color:#4a7c2c;background:#f0fdf4}.upload-icon{font-size:3rem;margin-bottom:15px;color:#9ca3af}.upload-text{color:#666;font-size:1.1rem;margin-bottom:10px}.upload-hint{color:#9ca3af;font-size:.9rem}.form-group{margin:20px 0}.form-label{display:block;font-weight:600;margin-bottom:8px;color:#333}.form-input{width:100%;padding:12px;border:2px solid #e5e7eb;border-radius:8px;font-size:1rem}.form-input:focus{outline:none;border-color:#4a7c2c}.image-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:20px;margin-top:30px}.image-card{background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 4px 15px rgba(0,0,0,.1);transition:transform .2s}.image-card:hover{transform:translateY(-5px)}.image-preview{width:100%;height:200px;object-fit:cover}.image-info{padding:15px}.image-caption{font-weight:600;color:#333;margin-bottom:8px}.image-meta{font-size:.85rem;color:#666;margin-bottom:5px}.status-badge{display:inline-block;padding:4px 12px;border-radius:12px;font-size:.85rem;font-weight:600}.status-pending{background:#fef3c7;color:#92400e}.status-approved{background:#d1fae5;color:#065f46}.status-rejected{background:#fee2e2;color:#991b1b}.btn{padding:10px 20px;border-radius:8px;font-weight:600;border:none;cursor:pointer;transition:all .3s;text-decoration:none;display:inline-block}.btn-primary{background:#4a7c2c;color:#fff}.btn-primary:hover{background:#2d5016}.btn-danger{background:#ef4444;color:#fff;font-size:.85rem;padding:6px 12px}.btn-danger:hover{background:#dc2626}.empty-state{text-align:center;padding:60px;color:#666}.empty-icon{font-size:4rem;margin-bottom:20px}
</style>
{% endblock %}
{% block content %}
<div class="gallery-container">
<a href="/admin/{{ library.slug }}" class="btn btn-primary" style="margin-bottom:20px">‚Üê Back to Dashboard</a>

<div class="gallery-header">
<h1 class="gallery-title">üì∏ Photo Gallery</h1>
<p style="color:#666;font-size:1.1rem">Upload and manage photos for {{ library.name }}</p>
</div>

<!-- Upload Section -->
<div class="upload-section">
<h2 style="color:#2d5016;margin-bottom:20px">üì§ Upload New Photo</h2>
<form method="POST" enctype="multipart/form-data" id="uploadForm">
<div class="upload-area" id="uploadArea">
<div class="upload-icon">üì∑</div>
<div class="upload-text">Click to upload or drag and drop</div>
<div class="upload-hint">PNG, JPG or JPEG (Max 5MB)</div>
<input type="file" name="image" id="imageInput" accept="image/*" style="display:none" required>
</div>

<div class="form-group">
<label class="form-label">Caption *</label>
<input type="text" name="caption" class="form-input" placeholder="Short caption for the photo" required maxlength="200">
</div>

<div class="form-group">
<label class="form-label">Description (Optional)</label>
<textarea name="description" class="form-input" rows="3" placeholder="Additional details about the photo" maxlength="500"></textarea>
</div>

<button type="submit" class="btn btn-primary" style="width:100%;padding:15px;font-size:1.1rem">
üì∏ Upload Photo for Review
</button>
</form>
</div>

<!-- My Uploads -->
<div class="upload-section">
<h2 style="color:#2d5016;margin-bottom:20px">üñºÔ∏è My Uploaded Photos</h2>
{% if my_images %}
<div class="image-grid">
{% for image in my_images %}
<div class="image-card">
<img src="/{{ image.file_path }}" alt="{{ image.caption }}" class="image-preview">
<div class="image-info">
<div class="image-caption">{{ image.caption }}</div>
{% if image.description %}
<div class="image-meta">{{ image.description }}</div>
{% endif %}
<div style="margin:10px 0">
{% if image.status.value == 'pending' %}
<span class="status-badge status-pending">‚è≥ Pending Review</span>
{% elif image.status.value == 'approved' %}
<span class="status-badge status-approved">‚úÖ Approved</span>
{% else %}
<span class="status-badge status-rejected">‚ùå Rejected</span>
{% endif %}
</div>
<div class="image-meta">Uploaded: {{ image.uploaded_at.strftime('%b %d, %Y') }}</div>
{% if image.status.value == 'rejected' and image.rejection_reason %}
<div style="background:#fee2e2;padding:10px;border-radius:6px;margin-top:10px;font-size:.85rem;color:#991b1b">
<strong>Reason:</strong> {{ image.rejection_reason }}
</div>
{% endif %}
<form method="POST" action="/admin/{{ library.slug }}/gallery/delete/{{ image.id }}" style="margin-top:10px" onsubmit="return confirm('Delete this photo?')">
<button type="submit" class="btn btn-danger">üóëÔ∏è Delete</button>
</form>
</div>
</div>
{% endfor %}
</div>
{% else %}
<div class="empty-state">
<div class="empty-icon">üì∑</div>
<p style="font-size:1.2rem;font-weight:600">No photos uploaded yet</p>
<p>Upload your first photo to get started!</p>
</div>
{% endif %}
</div>

</div>

<script>
// Upload area interactions
const uploadArea = document.getElementById('uploadArea');
const imageInput = document.getElementById('imageInput');

uploadArea.addEventListener('click', () => imageInput.click());

uploadArea.addEventListener('dragover', (e) => {
    e.preventDefault();
    uploadArea.classList.add('dragover');
});

uploadArea.addEventListener('dragleave', () => {
    uploadArea.classList.remove('dragover');
});

uploadArea.addEventListener('drop', (e) => {
    e.preventDefault();
    uploadArea.classList.remove('dragover');
    const files = e.dataTransfer.files;
    if (files.length > 0) {
        imageInput.files = files;
        uploadArea.querySelector('.upload-text').textContent = files[0].name;
    }
});

imageInput.addEventListener('change', (e) => {
    if (e.target.files.length > 0) {
        uploadArea.querySelector('.upload-text').textContent = e.target.files[0].name;
    }
});
</script>
{% endblock %}
